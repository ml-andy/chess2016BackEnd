function getUrlVars(){for(var a,e=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++)a=t[n].split("="),e.push(a[0]),e[a[0]]=a[1];return e}$(document).ready(function(){function a(a){if(G(!0),"banner"==a){if(!V.indexbanneruploadImg)return alert("請新增一張圖片"),void G(!1);J(V.indexbanneruploadImg,e)}else if("photo"==a){if(!V.indexphotouploadImg)return alert("請新增一張圖片"),void G(!1);J(V.indexphotouploadImg,t)}}function e(){V.insertdata={pic:V.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function t(){V.insertdata={pic:V.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function n(){if(V.indexload+=1,!(V.indexload<3)){for(var a=0;a<V.learndata.length;a++)if("index_banner"==V.learndata[a].collectname){$(".paper.banner").attr("num",a);for(var e=0;e<V.learndata[a].length;e++)$(".paper.banner").append('<li><div class="postphoto"><img src="'+V.learndata[a][e].pic+'"></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}else if("index_photo"==V.learndata[a].collectname){$(".paper.photo").attr("num",a);for(var e=0;e<V.learndata[a].length;e++)$(".paper.photo").append('<li><div class="postphoto"><img src="'+V.learndata[a][e].pic+'"></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}else if("index_video"==V.learndata[a].collectname){$(".paper.video").attr("num",a);for(var e=0;e<V.learndata[a].length;e++)$(".paper.video").append('<li><div class="posttitle"><a href="'+V.learndata[a][e].video+'" target="blank">'+V.learndata[a][e].video+'</a></div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div></div></li>')}s()}}function s(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().attr("item"),$(this).parent().attr("num"))):A($(this).parent().attr("item"),$(this).parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().attr("item"),$(this).parent().attr("num"))):($(this).addClass("on"),I(!0,$(this).parent().attr("item"),$(this).parent().attr("num")))}),$(".menuin a").removeClass("on").eq(0).addClass("on"),G(!1)}function r(){if(V.contactload+=1,!(V.contactload<2)){for(var a=0;a<V.learndata.length;a++)if("contactus"==V.learndata[a].collectname)for(var e=0;e<V.learndata[a].length;e++)$(".paper_addr").append('<li><div class="posttitle">'+V.learndata[a][e].addr+'</div><div class="btn" item="'+e+'" num="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');else if("emailbox"==V.learndata[a].collectname)for(var e=0;e<V.learndata[a].length;e++)$(".paper_mail").append('<li><div class="contact_name">'+V.learndata[a][e].username+'</div><div class="contact_phone">'+V.learndata[a][e].userphone+'</div><div class="contact_email">'+V.learndata[a][e].useremail+'</div><div class="contact_des">'+V.learndata[a][e].userword+'</div><div class="contact_date">'+V.learndata[a][e].postdate+'</div><div class="btn" item="'+e+'" num="'+a+'"><div title="刪除" class="delbtn"></div></div></li>');o()}}function o(){$(".paper_addr .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().attr("item"),$(this).parent().attr("num"))):alert("地址是必要資料，無法刪除。")}),$(".paper_addr .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().attr("item"),$(this).parent().attr("num"))):($(this).addClass("on"),I(!0,$(this).parent().attr("item")))}),$(".paper_mail .delbtn").click(function(){var a=confirm("確定刪除留言嗎?");1==a&&A($(this).parent().attr("item"),$(this).parent().attr("num"))}),$(".menuin a").removeClass("on").eq(6).addClass("on"),G(!1)}function l(){console.log(V.newPaperdata);for(var a=0;a<V.newPaperdata.length;a++)$(".paper").append('<li><div class="postphoto"><img src="'+V.newPaperdata[a].pic+'"></div><div class="posttitle"><a href="'+V.newPaperdata[a].link+'" target="_blank">'+V.newPaperdata[a].link+'</a></div><div class="btn" item="'+a+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');p()}function p(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().attr("item"))):A($(this).parent().attr("item"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().attr("item"))):($(this).addClass("on"),I(!0,$(this).parent().attr("item")))}),$(".menuin a").removeClass("on").eq(5).addClass("on"),G(!1)}function d(){return V.insertdata={title:$(".addgame .posttitle").val().replace(/\n\r?/g,"<br>"),list:[]},V.insertdata.title?(G(!0),void $.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):void alert(V.creatUsererrortxt)}function c(a){$(".gameboxout").html("");for(i in V.newPaperdata){$(".gameboxout").append('<div class="gamebox" gamenum="'+i+'"><div class="t awardspapertitle"><div class="posttitle">比賽名稱</div><div class="btn">功能</div></div><ul class="paper awardspapertitle" num="0"><li><div class="posttitle">'+V.newPaperdata[i].title+'</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li></ul><div class="new awardspapertitle"><div class="databox"><div class="lt"><input type="text" placeholder="請輸入姓名" class="username"><input type="text" placeholder="請輸入獎項" class="userdes"></div></div><button class="gobtn" gamenum="'+i+'">確定新增</button></div><div class="t"><div class="posttitle">姓名</div><div class="postdes">獎項</div><div class="btn">功能</div></div><ul class="paper awarditem" num="1"></ul></div>');for(j in V.newPaperdata[i].list)$(".gamebox").eq(i).find(".paper").eq(1).append('<li><div class="posttitle">'+V.newPaperdata[i].list[j].name+'</div><div class="postdes">'+V.newPaperdata[i].list[j].word+'</div><div class="btn" gamenum="'+i+'" item="'+j+'"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}m()}function m(){$(".paper.awardspapertitle .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),w(!1,$(this).parent().parent().parent().parent().attr("gamenum"))):v($(this).parent().parent().parent().parent().attr("gamenum"))}),$(".paper.awardspapertitle .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),b($(this).parent().parent().parent().parent().attr("gamenum"))):($(this).addClass("on"),w(!0,$(this).parent().parent().parent().parent().attr("gamenum")))}),$(".new .gobtn").click(function(){g($(this).attr("gamenum"))}),$(".paper.awarditem .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),h(!1,$(this).parent().attr("gamenum"),$(this).parent().attr("item"))):u($(this).parent().attr("gamenum"),$(this).parent().attr("item"))}),$(".paper.awarditem .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),f($(this).parent().attr("gamenum"),$(this).parent().attr("item"))):($(this).addClass("on"),h(!0,$(this).parent().attr("gamenum"),$(this).parent().attr("item")))}),$(".menuin a").removeClass("on").eq(4).addClass("on"),G(!1)}function u(a,e){G(!0),V.newPaperdata[a].list.splice(e,1),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function f(a,e){G(!0),V.newPaperdata[a].list[e].name=$(".gamebox").eq(a).find(".paper.awarditem li").eq(e).find(".posttitle textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[a].list[e].word=$(".gamebox").eq(a).find(".paper.awarditem li").eq(e).find(".postdes textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function h(a,e,t){a?($(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>")):($(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".posttitle").html(V.newPaperdata[e].list[t].name),$(".gamebox").eq(e).find(".paper.awarditem li").eq(t).find(".postdes").html(V.newPaperdata[e].list[t].word))}function g(a){G(!0),V.newPaperdata[a].list.push({name:$(".gamebox").eq(a).find(".new .username").val().replace(/\n\r?/g,"<br>"),word:$(".gamebox").eq(a).find(".new .userdes").val().replace(/\n\r?/g,"<br>")}),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function w(a,e){a?$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html("<textarea>"+$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"):$(".gamebox").eq(e).find(".paper.awardspapertitle").find(".posttitle").html(V.newPaperdata[e].title)}function b(a){G(!0),V.newPaperdata[a].title=$(".gamebox").eq(a).find(".paper.awardspapertitle").find(".posttitle textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[a]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function v(a){G(!0),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/awards"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}function y(){if(V.learnload+=1,!(V.learnload<2)){for(var a=0;a<V.learndata.length;a++)if("learning_page"==V.learndata[a].collectname)$(".paper").eq(0).append('<li><div class="postphoto"><img src="'+V.learndata[a][0].photo+'"></div><div class="posttitle">'+V.learndata[a][0].classinfo+'</div><div class="postdes">'+V.learndata[a][0].classdes+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div></div></li>');else if("learning_photo_page"==V.learndata[a].collectname)for(var e=0;e<V.learndata[a].length;e++)$(".paper").eq(1).append('<li><div class="postphoto"><img src="'+V.learndata[a][e].pic+'"></div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');_()}}function _(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):A($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):($(this).addClass("on"),I(!0,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num")))}),$(".menuin a").removeClass("on").eq(3).addClass("on"),G(!1)}function x(a){$(".paper").html("");for(i in V.newPaperdata)V.newPaperdata[i].bpic||(V.newPaperdata[i].bpic="images/space.png"),V.newPaperdata[i].spic||(V.newPaperdata[i].spic="images/space.png"),$(".paper").append('<li><div class="newsbpic"><img src="'+V.newPaperdata[i].bpic+'"></div><div class="newsspic"><img src="'+V.newPaperdata[i].spic+'"></div><div class="newstitle">'+V.newPaperdata[i].title+'</div><div class="newssword">'+V.newPaperdata[i].sword+'</div><div class="newsbword">'+V.newPaperdata[i].bword+'</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>');C()}function C(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().parent().index())):A($(this).parent().parent().index())}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().parent().index())):($(this).addClass("on"),I(!0,$(this).parent().parent().index()))}),$(".menuin a").removeClass("on").eq(2).addClass("on"),G(!1)}function k(a){$(".paper").html("");for(i in V.newPaperdata){var e;e=V.newPaperdata[i].cover?'<img src="'+V.newPaperdata[i].cover+'">':'<img src="images/space.png">',$(".paper").eq(0).append('<li><div class="postphoto">'+e+'</div><div class="posttitle">'+V.newPaperdata[i].title+'</div><div class="postdes">'+V.newPaperdata[i].info+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div></div></li>')}for(i in V.newPaperdata[0].list){var e;e=V.newPaperdata[0].list[i].pic?'<img src="'+V.newPaperdata[0].list[i].pic+'">':'<img src="images/space.png">',$(".paper").eq(1).append('<li><div class="postphoto">'+e+'</div><div class="posttitle">'+V.newPaperdata[0].list[i].name+'</div><div class="postdes">'+V.newPaperdata[0].list[i].des+'</div><div class="postid">　</div><div class="btn"><div title="修改" class="motify"></div><div title="刪除" class="delbtn"></div></div></li>')}P()}function P(){$(".paper .delbtn").click(function(){$(this).parent().find(".motify").hasClass("on")?($(this).parent().find(".motify").removeClass("on"),I(!1,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):A($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))}),$(".paper .motify").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),q($(this).parent().parent().index(),$(this).parent().parent().parent().attr("num"))):($(this).addClass("on"),I(!0,$(this).parent().parent().index(),$(this).parent().parent().parent().attr("num")))}),$(".menuin a").removeClass("on").eq(1).addClass("on"),G(!1)}function I(a,e,t){if(a){if(V.motifyPapering){if(alert(V.motifyerrortxt),t)for(var n=0;n<$("ul").length;n++)$("ul").eq(n).attr("num")==t&&$("ul").eq(n).find("li").eq(e).find(".motify").removeClass("on");else $("ul li").eq(e).find(".motify").removeClass("on");return}V.motifyPapering=!0}else V.motifyPapering=!1;if(V.wrp.hasClass("about")){var i=$(".paper").eq(t).find("li").eq(e);a?(i.find(".posttitle").html("<textarea>"+i.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postdes").html("<textarea>"+i.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){U(this,$(this))})):(i.find(".posttitle").html(i.find(".posttitle textarea").val().replace(/\n\r?/g,"<br>")),i.find(".postdes").html(i.find(".postdes textarea").val().replace(/\n\r?/g,"<br>")),i.find(".postphoto").html('<img src="'+V.newPaperdata[0].list[e].pic+'">'))}else if(V.wrp.hasClass("news")){var i=$(".paper").find("li").eq(e);a?(i.find(".newstitle").html("<textarea>"+i.find(".newstitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newsbword").html("<textarea>"+i.find(".newsbword").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newssword").html("<textarea>"+i.find(".newssword").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".newsbpic").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){U(this,$(this),0)}),i.find(".newsspic").prepend('<input type="file" name="file" id="imgInputMotify2" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify2"><span>點擊更換</span></label>'),$("#imgInputMotify2").change(function(){U(this,$(this),1)})):(i.find(".newstitle").html(i.find(".newstitle textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newsbword").html(i.find(".newsbword textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newssword").html(i.find(".newssword textarea").val().replace(/\n\r?/g,"<br>")),i.find(".newsbpic").html('<img src="'+V.newPaperdata[e].bpic+'">'),i.find(".newsspic").html('<img src="'+V.newPaperdata[e].spic+'">'))}else if(V.wrp.hasClass("learn")){var i=$(".paper").eq(t).find("li").eq(e);a?(0==t&&(i.find(".posttitle").html("<textarea>"+i.find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"),i.find(".postdes").html("<textarea>"+i.find(".postdes").html().replace(/<br>/g,"\n")+"</textarea>")),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){U(this,$(this))})):i.find(".postphoto").html('<img src="'+V.learndata[1][e].pic+'">')}else if(V.wrp.hasClass("link")){var i=$(".paper li").eq(e);a?(i.find(".posttitle").html("<textarea>"+i.find(".posttitle a").html()+"</textarea>"),i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){U(this,$(this))})):(i.find(".posttitle").html('<a href="'+V.newPaperdata[e].link+'">'+V.newPaperdata[e].link+"</a>"),i.find(".postphoto").html('<img src="'+V.newPaperdata[e].pic+'">'))}else if(V.wrp.hasClass("contact"))a?$(".paper_addr li").eq(e).find(".posttitle").html("<textarea>"+$(".paper_addr li").eq(e).find(".posttitle").html().replace(/<br>/g,"\n")+"</textarea>"):$(".paper_addr li").eq(e).find(".posttitle").html(V.learndata[t][e].addr);else if(V.wrp.hasClass("index"))if("index_banner"==V.learndata[t].collectname){var i=$(".paper.banner li").eq(e);a?(i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify"><span>點擊更換</span></label>'),$("#imgInputMotify").change(function(){U(this,$(this),0)})):i.find(".postphoto").html('<img src="'+V.learndata[t][e].pic+'">')}else if("index_photo"==V.learndata[t].collectname){var i=$(".paper.photo li").eq(e);a?(i.find(".postphoto").prepend('<input type="file" name="file" id="imgInputMotify2" accept="image/*" capture="camera"><label class="imgInputlabel" for="imgInputMotify2"><span>點擊更換</span></label>'),$("#imgInputMotify2").change(function(){U(this,$(this),1)})):i.find(".postphoto").html('<img src="'+V.learndata[t][e].pic+'">')}else if("index_video"==V.learndata[t].collectname){var i=$(".paper.video li").eq(e);a?i.find(".posttitle").html("<textarea>"+i.find(".posttitle a").html()+"</textarea>"):i.find(".posttitle").html('<a href="'+V.learndata[t][e].video+'">'+V.learndata[t][e].video+"</a>")}}function q(a,e){G(!0),V.wrp.hasClass("about")?(V._n=a,V._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?J(V.uploadImg,T):(V.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),T())):V.wrp.hasClass("news")?(V._n=a,V.newspiccheck=0,$(".paper").find("li").eq(a).find(".newsbpic").find("img").hasClass("on")?J(V.uploadImgbpic,T,0):(V.newspiccheck+=1,V.uploadImgbpic=$(".paper").find("li").eq(a).find(".newsbpic").find("img").attr("src")),$(".paper").find("li").eq(a).find(".newsspic").find("img").hasClass("on")?J(V.uploadImgspic,T,1):(V.newspiccheck+=1,V.uploadImgspic=$(".paper").find("li").eq(a).find(".newsspic").find("img").attr("src")),T()):V.wrp.hasClass("learn")?(V._n=a,V._num=e,$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").hasClass("on")?J(V.uploadImg,T):(V.uploadImgTrue=$(".paper").eq(e).find("li").eq(a).find(".postphoto").find("img").attr("src"),T())):V.wrp.hasClass("link")?(V._n=a,$(".paper li").eq(a).find(".postphoto").find("img").hasClass("on")?J(V.uploadImg,T):(V.uploadImgTrue=$(".paper li").eq(a).find(".postphoto").find("img").attr("src"),T())):V.wrp.hasClass("contact")?(V._n=a,V._num=e,T()):V.wrp.hasClass("index")&&(V._n=a,V._num=e,"index_banner"==V.learndata[V._num].collectname?$(".paper.banner li").eq(V._n).find(".postphoto").find("img").hasClass("on")?J(V.uploadImgindexbannerpic,T):(V.uploadImgTrue=$(".paper.banner li").eq(V._n).find(".postphoto").find("img").attr("src"),T()):"index_photo"==V.learndata[V._num].collectname?$(".paper.photo li").eq(V._n).find(".postphoto").find("img").hasClass("on")?J(V.uploadImgindexphotopic,T):(V.uploadImgTrue=$(".paper.photo li").eq(V._n).find(".postphoto").find("img").attr("src"),T()):"index_video"==V.learndata[V._num].collectname&&T())}function T(){if(V.wrp.hasClass("about"))0==V._num?(V.newPaperdata[0].title=$(".paper").eq(V._num).find("li").eq(V._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[0].info=$(".paper").eq(V._num).find("li").eq(V._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[0].cover=V.uploadImgTrue):1==V._num&&(V.newPaperdata[0].list[V._n].name=$(".paper").eq(V._num).find("li").eq(V._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[0].list[V._n].des=$(".paper").eq(V._num).find("li").eq(V._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[0].list[V._n].pic=V.uploadImgTrue),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata),success:function(a){N("aboutus_page",k)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("news")){if(V.newspiccheck<2)return;V.newPaperdata[V._n].title=$(".paper").find("li").eq(V._n).find(".newstitle").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[V._n].spic=V.uploadImgspic,V.newPaperdata[V._n].bpic=V.uploadImgbpic,V.newPaperdata[V._n].date=(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+R((new Date).getDay()),V.newPaperdata[V._n].sword=$(".paper").find("li").eq(V._n).find(".newssword").find("textarea").val().replace(/\n\r?/g,"<br>"),V.newPaperdata[V._n].bword=$(".paper").find("li").eq(V._n).find(".newsbword").find("textarea").val().replace(/\n\r?/g,"<br>"),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+V.nowpage+"/"+V.newPaperdata[V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[V._n]),success:function(a){N("news_page",x)},error:function(a,e,t){console.log("error:",a,e,t)}})}else if(V.wrp.hasClass("learn"))0==V._num?(V.learndata[0][0].classinfo=$(".paper").eq(V._num).find("li").eq(V._n).find(".posttitle").find("textarea").val().replace(/\n\r?/g,"<br>"),V.learndata[0][0].classdes=$(".paper").eq(V._num).find("li").eq(V._n).find(".postdes").find("textarea").val().replace(/\n\r?/g,"<br>"),V.learndata[0][0].photo=V.uploadImgTrue,V.learndata[0][0].title=V.learndata[0][0].title,console.log(V.learndata[0][0].title),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[0]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):1==V._num&&(V.learndata[1][V._n].pic=V.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[1]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}));else if(V.wrp.hasClass("link"))V.newPaperdata[V._n].link=$(".paper li").eq(V._n).find(".posttitle textarea").val(),V.newPaperdata[V._n].pic=V.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+V.nowpage+"/"+V.newPaperdata[V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata[V._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("contact")){if(V.learndata[V._num][V._n].addr=$(".paper_addr li").eq(V._n).find(".posttitle textarea").val(),!V.learndata[V._num][V._n].addr)return void alert(V.creatUsererrortxt);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/contactus"+V.nowpage+"/"+V.learndata[V._num][V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[V._num][V._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}else if(V.wrp.hasClass("index"))if("index_banner"==V.learndata[V._num].collectname)V.learndata[V._num][V._n].pic=V.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+V.nowpage+"/"+V.learndata[V._num][V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[V._num][V._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if("index_photo"==V.learndata[V._num].collectname)V.learndata[V._num][V._n].pic=V.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+V.nowpage+"/"+V.learndata[V._num][V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[V._num][V._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if("index_video"==V.learndata[V._num].collectname){if(V.learndata[V._num][V._n].video=$(".paper.video li").eq(V._n).find(".posttitle textarea").val(),!V.learndata[V._num][V._n].video)return void alert(V.creatUsererrortxt);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_video"+V.nowpage+"/"+V.learndata[V._num][V._n]._id.$oid+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.learndata[V._num][V._n]),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}}function A(a,e){if(G(!0),V.wrp.hasClass("about"))V.newPaperdata[0].list.splice(a,1),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata),success:function(a){N("aboutus_page",k)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("news"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){N("news_page",x)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("learn"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+V.nowpage+"/"+V.learndata[e][a]._id.$oid+"?apiKey="+V.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("link"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+V.nowpage+"/"+V.newPaperdata[a]._id.$oid+"?apiKey="+V.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("contact"))$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/emailbox"+V.nowpage+"/"+V.learndata[e][a]._id.$oid+"?apiKey="+V.mlabApikey,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("index")){var t;"index_banner"==V.learndata[e].collectname?t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_banner"+V.nowpage+"/"+V.learndata[e][a]._id.$oid+"?apiKey="+V.mlabApikey:"index_photo"==V.learndata[e].collectname?t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_photo"+V.nowpage+"/"+V.learndata[e][a]._id.$oid+"?apiKey="+V.mlabApikey:"index_video"==V.learndata[e].collectname&&(t="https://api.mlab.com/api/1/databases/chinesechess2016/collections/index_video"+V.nowpage+"/"+V.learndata[e][a]._id.$oid+"?apiKey="+V.mlabApikey),$.ajax({url:t,type:"DELETE",async:!0,timeout:3e5,contentType:"application/json",success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}}function K(a,e,t){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?V.indexbanneruploadImg=a.target.result.replace(/.*,/,""):V.indexphotouploadImg=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function O(a,e,t){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?V.newsuploadImgbpic=a.target.result.replace(/.*,/,""):V.newsuploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function U(a,e,t){if(V.wrp.hasClass("about")||V.wrp.hasClass("learn")||V.wrp.hasClass("link")){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){V.uploadImg=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}else if(V.wrp.hasClass("news")){if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?V.uploadImgbpic=a.target.result.replace(/.*,/,""):V.uploadImgspic=a.target.result.replace(/.*,/,""),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}else if(V.wrp.hasClass("index")&&a.files&&a.files[0]){var n=new FileReader;n.onload=function(a){0==t?V.uploadImgindexbannerpic=a.target.result.replace(/.*,/,""):V.uploadImgindexphotopic=a.target.result.replace(/.*,/,""),
console.log(e.parent().addClass("on").find("img").addClass("on")),e.parent().addClass("on").find("img").addClass("on").attr("src",a.target.result)},n.readAsDataURL(a.files[0])}}function S(){if(V.wrp.hasClass("about")){if(V.posttitleval=$(".new .posttitle").val(),V.postdesval=$(".new .postdes").val(),!V.posttitleval||!V.postdesval)return void alert(V.creatUsererrortxt);G(!0),V.uploadImg?J(V.uploadImg,M):M()}else if(V.wrp.hasClass("news")){if(V.insertdata={title:$(".new .newstitle").val().replace(/\n\r?/g,"<br>"),date:(new Date).getFullYear()+"/"+(1*(new Date).getMonth()+1)+"/"+(new Date).getDate()+"星期"+R((new Date).getDay()),sword:$(".new .newssword").val().replace(/\n\r?/g,"<br>"),bword:$(".new .newsbword").val().replace(/\n\r?/g,"<br>")},!V.insertdata.title||!V.insertdata.sword||!V.insertdata.bword)return void alert(V.creatUsererrortxt);G(!0),V.newsinsertpiccheck=0,V.newsuploadImgbpic?D(V.newsuploadImgbpic,M,0):(V.newsinsertpiccheck+=1,V.newsuploadImgbpic="images/space.png"),V.newsuploadImgspic?D(V.newsuploadImgspic,M,1):(V.newsinsertpiccheck+=1,V.newsuploadImgspic="images/space.png"),M()}else if(V.wrp.hasClass("learn"))G(!0),V.uploadImg?J(V.uploadImg,M):alert(V.creatUsererrortxt);else if(V.wrp.hasClass("link")){if(G(!0),V.insertdata={link:$(".new .posttitle").val()},!V.insertdata.link)return void alert(V.creatUsererrortxt);V.uploadImg?J(V.uploadImg,M):alert(V.creatUsererrortxt)}}function M(){if(V.wrp.hasClass("about"))V.newPaperdata[0].list.push({name:V.posttitleval.replace(/\n\r?/g,"<br>"),des:V.postdesval.replace(/\n\r?/g,"<br>"),pic:V.uploadImgTrue}),$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/aboutus_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"PUT",contentType:"application/json",data:JSON.stringify(V.newPaperdata),success:function(a){B(),N("aboutus_page",k)},error:function(a,e,t){console.log("error:",a,e,t)}});else if(V.wrp.hasClass("news")){if(V.newsinsertpiccheck<2)return;V.insertdata.bpic=V.newsuploadImgbpic,V.insertdata.spic=V.newsuploadImgspic,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/news_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})}else V.wrp.hasClass("learn")?(V.insertdata={pic:V.uploadImgTrue},$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/learning_photo_page"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}})):V.wrp.hasClass("link")&&(V.insertdata.pic=V.uploadImgTrue,$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/otherlink"+V.nowpage+"?apiKey="+V.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify(V.insertdata),success:function(a){location.reload()},error:function(a,e,t){console.log("error:",a,e,t)}}))}function D(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+V.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){V.wrp.hasClass("news")&&(V.newsinsertpiccheck+=1,0==t?V.newsuploadImgbpic=a.data.link:V.newsuploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+V.imgurappid}})}function J(a,e,t){$.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Bearer "+V.imgurToken,Accept:"application/json"},data:{image:a,type:"base64"},success:function(a){(V.wrp.hasClass("about")||V.wrp.hasClass("learn")||V.wrp.hasClass("link")||V.wrp.hasClass("index"))&&(V.uploadImgTrue=a.data.link),V.wrp.hasClass("news")&&(V.newspiccheck+=1,0==t?V.uploadImgbpic=a.data.link:V.uploadImgspic=a.data.link),e()},error:function(a,e,t){console.log("error:",a,e,t),window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+V.imgurappid}})}function N(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+a+V.nowpage+'?s={"_id":-1}&apiKey='+V.mlabApikey,type:"GET",contentType:"application/json",success:function(a){V.newPaperdata=a,e(a)},error:function(a,e,t){console.log("error:",a,e,t)}})}function E(a,e){$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/"+a+V.nowpage+'?s={"_id":-1}&apiKey='+V.mlabApikey,type:"GET",contentType:"application/json",success:function(t){V.learndata.push(t),V.learndata[V.learndata.length-1].collectname=a,e()},error:function(a,e,t){console.log("error:",a,e,t)}})}function R(a){return 0==a?a="日":1==a?a="一":2==a?a="二":3==a?a="三":4==a?a="四":5==a?a="五":6==a&&(a="六"),a}function L(a){window.location.href=a.attr("gopage")+"#access_token="+window.location.href.split("#access_token=")[1]}function F(){$.cookie("useraccount",""),$.cookie("userpassword",""),window.location.href="index.html"}function z(){var a=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(a=!0),a}function B(){V.posttitleval="",V.nowtime="",V.postdesval="",V.uploadImg="",V.uploadImgTrue="",$(".new .posttitle").val(""),$(".new .postdes").val(""),$(".new .addImg").removeClass("on").find("img").attr("src","")}function G(a){a?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var V={};V.wrp=$(".wrapper"),V.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",V.imgurappid="752b0363900112d",V.creatUsererrortxt="請填寫完整資料",V.motifyerrortxt="上一筆資料還在修改中，請先完成上一筆修改再繼續。";try{V.nowpage=getUrlVars().page.replace("#access_token","")}catch(W){V.nowpage=1}$(".sec_menu").length>0&&($(".sec_menu a").eq(V.nowpage-1).addClass("on"),$(".title").eq(0).html($(".sec_menu a").eq(V.nowpage-1).text())),V.wrp.hasClass("about")?N("aboutus_page",k):V.wrp.hasClass("news")?N("news_page",x):V.wrp.hasClass("learn")?(V.learnload=0,V.learndata=[],E("learning_page",y),E("learning_photo_page",y)):V.wrp.hasClass("awards")?N("awards",c):V.wrp.hasClass("link")?N("otherlink",l):V.wrp.hasClass("contact")?(V.contactload=0,V.learndata=[],E("contactus",r),E("emailbox",r)):V.wrp.hasClass("index")?(V.indexload=0,V.learndata=[],E("index_banner",n),E("index_photo",n),E("index_video",n)):G(!1),$("#indeximgInput").change(function(){K(this,$(this),0)}),$("#indeximgInput2").change(function(){K(this,$(this),1)}),$(".maingobtn").click(function(){a($(this).parent().attr("nam"))}),$(".gogamebtn").click(function(){d()}),$(".menua").click(function(){L($(this))}),$("#imgInput").change(function(){U(this,$(this))}),$("#newsimgInput").change(function(){O(this,$(this),0)}),$("#newsimgInput2").change(function(){O(this,$(this),1)}),$(".userMenu .logoutbtn").click(function(){F()}),$(".new .gobtn").click(function(){S()}),$(window).load(function(){if(z())try{V.imgurToken=window.location.href.split("#")[1].split("&")[0].replace("access_token=",""),$(".userMenu .icon").html($.cookie("useraccount").substring(0,1)),$(".userMenu .name").html($.cookie("username"))}catch(a){window.location.href="https://api.imgur.com/oauth2/authorize?response_type=token&client_id="+V.imgurappid}else window.location.href="index.html"+window.location.hash})});