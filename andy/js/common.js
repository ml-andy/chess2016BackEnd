$(document).ready(function(){function n(){var n='https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?q={useraccount:"'+$(".login_page .signaccount").val()+'"}&apiKey='+r.mlabApikey;l(!0),$.ajax({url:n,type:"GET",contentType:"application/json",success:function(n){r.issignup=n,i()},error:function(n,i,o){console.log("error:",n,i,o)}})}function i(){if(""==r.issignup){if(!($(".login_page_sign .signname").val()&&$(".login_page_sign .signpassword").val()&&$(".login_page_sign .signaccount").val()&&$(".login_page_sign .signemail").val()))return alert(r.creatUsererrortxt),void l(!1);$.ajax({url:"https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?apiKey="+r.mlabApikey,type:"POST",contentType:"application/json",data:JSON.stringify({username:$(".login_page_sign .signname").val(),userpassword:$(".login_page_sign .signpassword").val(),useraccount:$(".login_page_sign .signaccount").val(),useremail:$(".login_page_sign .signemail").val()}),success:function(n){l(!1),$(".msg").fadeIn(),setTimeout(function(){$(".msg").fadeOut()},5e3),c(),o(!1)},error:function(n,i,o){console.log("error:",n,i,o)}})}else l(!1),alert(r.signerrortxt)}function o(n){n?$(".login_pagein").addClass("on"):$(".login_pagein").removeClass("on")}function a(n,i){var o='https://api.mlab.com/api/1/databases/chinesechess2016/collections/user?q={useraccount:"'+n+'",userpassword:"'+i+'"}&apiKey='+r.mlabApikey;l(!0),$.ajax({url:o,type:"GET",contentType:"application/json",success:function(n){r.islogin=n,c(),e()},error:function(n,i,o){console.log("error:",n,i,o)}})}function e(){""!=r.islogin?($.cookie("useraccount",r.islogin[0].useraccount),$.cookie("userpassword",r.islogin[0].userpassword),$.cookie("username",r.islogin[0].username),window.location.href="main.html"+window.location.hash):(l(!1),alert(r.loginerrortxt))}function s(){var n=!1;return $.cookie("useraccount")&&$.cookie("userpassword")&&(n=!0),n}function c(){$(".login_page_sign .signname").val(""),$(".login_page_sign .signpassword").val(""),$(".login_page_sign .signaccount").val(""),$(".login_page_sign .signemail").val(""),$(".login_pagein").find("input").val("")}function l(n){n?$(".loading").fadeIn():($(".loading").hasClass("on")||$(".loading").addClass("on"),$(".loading").fadeOut())}var r={};r.mlabApikey="n6FXodWWCdM14KrePZHrRPPovbzboRn6",r.loginerrortxt="帳號或密碼錯誤，請重新輸入",r.signerrortxt="此帳號有人註冊過，請換一個帳號",r.creatUsererrortxt="請填寫完整資料",$(".login_pagein .submitbtn").click(function(){n()}),$(".login_pagein .cancelbtn").click(function(){o(!1)}),$(".login_pagein .singupbtn").click(function(){o(!0)}),$(".login_pagein .surebtn").click(function(){a($(".login_page .useraccount").val(),$(".login_page .userpassword").val())}),$(window).load(function(){s()?a($.cookie("useraccount"),$.cookie("userpassword")):l(!1)})});